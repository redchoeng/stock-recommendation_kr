<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="300">
    <title>PROJECT TITAN KR - 한국 주식 투자 분석</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #f7f8fa;
            --surface: #ffffff;
            --text: #191f28;
            --text-sub: #8b95a1;
            --text-muted: #b0b8c1;
            --border: #e5e8eb;
            --accent: #4263eb;
            --accent-light: #edf2ff;
            --green: #20c997;
            --green-bg: #e6fcf5;
            --red: #f06595;
            --red-bg: #fff0f6;
            --radius: 16px;
            --shadow: 0 2px 8px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-hover: 0 8px 24px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.04);
        }

        body {
            font-family: 'Pretendard Variable', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 24px 20px 40px;
        }

        /* 마켓 스위처 */
        .market-switcher {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-bottom: 32px;
            background: var(--surface);
            border-radius: 12px;
            padding: 4px;
            box-shadow: var(--shadow);
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .market-btn {
            padding: 10px 24px;
            font-size: 0.9em;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: var(--text-sub);
            display: flex;
            align-items: center;
            gap: 6px;
            background: transparent;
        }
        .market-btn.active {
            background: var(--accent);
            color: white;
        }
        .market-btn:not(.active):hover {
            background: var(--accent-light);
            color: var(--accent);
        }

        /* 헤더 */
        .header {
            text-align: center;
            margin-bottom: 28px;
        }
        .header h1 {
            font-size: 1.75em;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 8px;
        }
        .header p {
            color: var(--text-sub);
            font-size: 0.95em;
            line-height: 1.6;
        }

        /* 스탯 그리드 */
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        .stat-value {
            font-size: 1.15em;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 0.78em;
            color: var(--text-sub);
        }

        /* 선물 위젯 */
        .futures-card {
            background: #1b1d2a;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .futures-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .futures-title {
            color: #e9ecef;
            font-weight: 700;
            font-size: 0.95em;
        }
        .futures-session {
            font-size: 0.8em;
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 600;
        }
        .futures-session.live { background: rgba(240,101,149,0.15); color: var(--red); }
        .futures-session.market { background: rgba(32,201,151,0.15); color: var(--green); }
        .futures-session.closed { background: rgba(139,149,161,0.15); color: var(--text-sub); }
        @keyframes pulse-live { 0%,100%{opacity:1;} 50%{opacity:0.6;} }
        .futures-session.live { animation: pulse-live 2s infinite; }
        .futures-message {
            text-align: center;
            padding: 12px 16px;
            margin-top: 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.88em;
            line-height: 1.5;
        }
        .futures-message.up { background: rgba(32,201,151,0.1); color: var(--green); }
        .futures-message.down { background: rgba(240,101,149,0.1); color: var(--red); }
        .futures-message.neutral { background: rgba(139,149,161,0.08); color: #adb5bd; }

        /* 리포트 카드 */
        .report-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .report-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 24px 20px;
            text-decoration: none;
            color: inherit;
            transition: all 0.25s ease;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        .report-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }
        .report-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
        }
        .report-card.growth::before { background: linear-gradient(90deg, #4263eb, #7c3aed); }
        .report-card.value::before { background: linear-gradient(90deg, #f59f00, #fd7e14); }
        .report-card.search::before { background: linear-gradient(90deg, #20c997, #12b886); }

        .report-card .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .report-card.growth .badge { background: var(--accent-light); color: var(--accent); }
        .report-card.value .badge { background: #fff9db; color: #e67700; }
        .report-card.search .badge { background: var(--green-bg); color: #0ca678; }

        .report-card h3 {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }
        .report-card .desc {
            font-size: 0.85em;
            color: var(--text-sub);
            line-height: 1.5;
            margin-bottom: 16px;
        }
        .report-card .features {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .report-card .feature {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.82em;
            color: var(--text-sub);
        }
        .feature-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--accent);
            flex-shrink: 0;
        }
        .report-card.value .feature-dot { background: #f59f00; }
        .report-card.search .feature-dot { background: var(--green); }

        .report-card .enter {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 16px;
            font-size: 0.88em;
            font-weight: 600;
            color: var(--accent);
        }
        .report-card.value .enter { color: #e67700; }
        .report-card.search .enter { color: #0ca678; }

        /* 푸터 */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 0.8em;
            line-height: 1.7;
        }

        /* 반응형 */
        @media (max-width: 640px) {
            .stats { grid-template-columns: repeat(2, 1fr); }
            .report-cards { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.4em; }
            .container { padding: 16px 16px 32px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="market-switcher">
            <a href="https://redchoeng.github.io/stock-recommendation_2.0/" class="market-btn">US</a>
            <span class="market-btn active">KR</span>
        </div>

        <div class="header">
            <h1>Project Titan KR</h1>
            <p>Fundamental + Technical 기반 한국 주식 분석</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="updateTime">-</div>
                <div class="stat-label">마지막 업데이트</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="nextUpdate">-</div>
                <div class="stat-label">다음 업데이트</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">150+</div>
                <div class="stat-label">분석 종목</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">8회/일</div>
                <div class="stat-label">자동 업데이트</div>
            </div>
        </div>

        <div class="futures-card">
            <div class="futures-top">
                <span class="futures-title">KOSPI 200 야간선물</span>
                <span class="futures-session closed" id="futuresSession">--</span>
            </div>
            <div class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                {
                    "symbol": "KRX:101",
                    "width": "100%",
                    "height": 220,
                    "locale": "kr",
                    "dateRange": "1D",
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "autosize": false,
                    "largeChartUrl": ""
                }
                </script>
            </div>
            <div class="futures-message neutral" id="futuresMessage">데이터 로딩 중...</div>
        </div>

        <div class="report-cards">
            <a href="titan_kr_growth_report.html" class="report-card growth">
                <span class="badge">Growth</span>
                <h3>성장주 분석</h3>
                <p class="desc">반도체 / 2차전지 / 바이오 / 방산 / 조선</p>
                <div class="features">
                    <div class="feature"><span class="feature-dot"></span>ROE, OPM, 매출성장률 분석</div>
                    <div class="feature"><span class="feature-dot"></span>MA, RSI, MACD, 일목균형표</div>
                    <div class="feature"><span class="feature-dot"></span>시장 레짐 감지 + 정책 보너스</div>
                </div>
                <span class="enter">리포트 보기 &rarr;</span>
            </a>

            <a href="titan_kr_value_report.html" class="report-card value">
                <span class="badge">Value</span>
                <h3>가치주 분석</h3>
                <p class="desc">금융 / 통신 / 유틸리티 / 건설 / 소비재</p>
                <div class="features">
                    <div class="feature"><span class="feature-dot"></span>배당 / 저평가 종목 스크리닝</div>
                    <div class="feature"><span class="feature-dot"></span>밸류업 프로그램 보너스</div>
                    <div class="feature"><span class="feature-dot"></span>역발상 조정 (과매도 가산)</div>
                </div>
                <span class="enter">리포트 보기 &rarr;</span>
            </a>

            <a href="search.html" class="report-card search">
                <span class="badge">Search</span>
                <h3>종목 검색</h3>
                <p class="desc">종목코드 또는 기업명으로 조회</p>
                <div class="features">
                    <div class="feature"><span class="feature-dot"></span>Growth + Value 통합 검색</div>
                    <div class="feature"><span class="feature-dot"></span>점수 / 매수가 / 목표가 / 손절가</div>
                </div>
                <span class="enter">검색하기 &rarr;</span>
            </a>
        </div>

        <div class="footer">
            <p>본 리포트는 알고리즘 기반 투자 참고 자료이며, 투자 손실에 대한 책임은 본인에게 있습니다.</p>
            <p style="margin-top: 6px;">Project Titan KR &middot; GitHub Actions 자동 배포 &middot; 08 / 09 / 10 / 12 / 14 / 15 / 17 / 20시 KST</p>
        </div>
    </div>

    <script>
        // 마지막 업데이트 시간
        fetch('last_updated.json?' + Date.now())
            .then(r => r.json())
            .then(d => document.getElementById('updateTime').textContent = d.timestamp)
            .catch(() => document.getElementById('updateTime').textContent = '-');

        // 다음 업데이트
        function showNextUpdate() {
            const schedule = [[8,0],[9,0],[10,0],[12,0],[14,0],[15,0],[17,0],[20,0]];
            const now = new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Seoul"}));
            const day = now.getDay(), nowMin = now.getHours()*60+now.getMinutes();
            let next = '';
            if (day >= 1 && day <= 5) {
                for (const [h,m] of schedule) {
                    if (nowMin < h*60+m) { next = String(h).padStart(2,'0')+':'+String(m).padStart(2,'0'); break; }
                }
            }
            if (!next) next = (day >= 1 && day < 5) ? '내일 08:00' : '월 08:00';
            document.getElementById('nextUpdate').textContent = next;
        }
        showNextUpdate();
        setInterval(showNextUpdate, 60000);

        // 야간선물
        async function updateFutures() {
            const msg = document.getElementById('futuresMessage');
            const sess = document.getElementById('futuresSession');
            const now = new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Seoul"}));
            const h = now.getHours(), day = now.getDay();

            if ((h >= 18 || h < 6) && day >= 1 && day <= 5) {
                sess.textContent = 'LIVE'; sess.className = 'futures-session live';
            } else if (h >= 9 && h < 16 && day >= 1 && day <= 5) {
                sess.textContent = '정규장'; sess.className = 'futures-session market';
            } else {
                sess.textContent = '마감'; sess.className = 'futures-session closed';
            }

            try {
                const res = await fetch('https://query1.finance.yahoo.com/v8/finance/chart/%5EKS200?range=1d&interval=5m');
                const data = await res.json();
                const meta = data.chart.result[0].meta;
                const prev = meta.chartPreviousClose || meta.previousClose;
                const cur = meta.regularMarketPrice;
                const pct = ((cur - prev) / prev * 100);

                if (pct > 0.3) {
                    msg.className = 'futures-message up';
                    const msgs = [
                        `+${pct.toFixed(2)}% 상승 중 \u2014 내일 갭상 기대되네요!`,
                        `+${pct.toFixed(2)}% 순항 중! 오늘 밤 편히 주무세요`,
                        `+${pct.toFixed(2)}% 상승! 내일이 기대됩니다`
                    ];
                    msg.textContent = msgs[Math.floor(Math.random()*msgs.length)];
                } else if (pct < -0.3) {
                    msg.className = 'futures-message down';
                    const msgs = [
                        `${pct.toFixed(2)}% \u2014 조정은 매수 기회입니다`,
                        `${pct.toFixed(2)}% 하락 중... 장기 투자의 길은 멀어요`,
                        `${pct.toFixed(2)}% \u2014 내일 반등을 기대해봐요`
                    ];
                    msg.textContent = msgs[Math.floor(Math.random()*msgs.length)];
                } else {
                    msg.className = 'futures-message neutral';
                    msg.textContent = `${pct >= 0 ? '+' : ''}${pct.toFixed(2)}% 보합 \u2014 시장이 방향을 탐색 중`;
                }
            } catch(e) {
                msg.className = 'futures-message neutral';
                if (h >= 18 || h < 6) msg.textContent = '야간선물 거래 중 \u2014 차트에서 확인하세요';
                else if (h >= 9 && h < 16) msg.textContent = '정규장 진행 중';
                else msg.textContent = '장 마감 \u2014 야간선물은 18:00부터';
            }
        }
        updateFutures();
        setInterval(updateFutures, 300000);
    </script>
</body>
</html>
